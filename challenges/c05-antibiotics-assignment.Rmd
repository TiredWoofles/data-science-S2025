---
title: "Antibiotics"
author: "(Suwanee Li)"
date: 2025-03-06
output:
  github_document
editor_options: 
  markdown: 
    wrap: 72
---

*Purpose*: Creating effective data visualizations is an *iterative*
process; very rarely will the first graph you make be the most
effective. The most effective thing you can do to be successful in this
iterative process is to *try multiple graphs* of the same data.

Furthermore, judging the effectiveness of a visual is completely
dependent on *the question you are trying to answer*. A visual that is
totally ineffective for one question may be perfect for answering a
different question.

In this challenge, you will practice *iterating* on data visualization,
and will anchor the *assessment* of your visuals using two different
questions.

*Note*: Please complete your initial visual design **alone**. Work on
both of your graphs alone, and save a version to your repo *before*
coming together with your team. This way you can all bring a diversity
of ideas to the table!

<!-- include-rubric -->

# Grading Rubric

<!-- -------------------------------------------------- -->

Unlike exercises, **challenges will be graded**. The following rubrics
define how you will be graded, both on an individual and team basis.

## Individual

<!-- ------------------------- -->

| Category | Needs Improvement | Satisfactory |
|----|----|----|
| Effort | Some task **q**'s left unattempted | All task **q**'s attempted |
| Observed | Did not document observations, or observations incorrect | Documented correct observations based on analysis |
| Supported | Some observations not clearly supported by analysis | All observations clearly supported by analysis (table, graph, etc.) |
| Assessed | Observations include claims not supported by the data, or reflect a level of certainty not warranted by the data | Observations are appropriately qualified by the quality & relevance of the data and (in)conclusiveness of the support |
| Specified | Uses the phrase "more data are necessary" without clarification | Any statement that "more data are necessary" specifies which *specific* data are needed to answer what *specific* question |
| Code Styled | Violations of the [style guide](https://style.tidyverse.org/) hinder readability | Code sufficiently close to the [style guide](https://style.tidyverse.org/) |

## Submission

<!-- ------------------------- -->

Make sure to commit both the challenge report (`report.md` file) and
supporting files (`report_files/` folder) when you are done! Then submit
a link to Canvas. **Your Challenge submission is not complete without
all files uploaded to GitHub.**

```{r setup}
library(tidyverse)
library(ggrepel)
```

*Background*: The data[1] we study in this challenge report the
[*minimum inhibitory
concentration*](https://en.wikipedia.org/wiki/Minimum_inhibitory_concentration)
(MIC) of three drugs for different bacteria. The smaller the MIC for a
given drug and bacteria pair, the more practical the drug is for
treating that particular bacteria. An MIC value of *at most* 0.1 is
considered necessary for treating human patients.

These data report MIC values for three antibiotics---penicillin,
streptomycin, and neomycin---on 16 bacteria. Bacteria are categorized
into a genus based on a number of features, including their resistance
to antibiotics.

```{r load}
## NOTE: If you extracted all challenges to the same location,
## you shouldn't have to change this filename
filename <- "./data/antibiotics.csv"

## Load the data
df_antibiotics <- read_csv(filename)
df_antibiotics %>% knitr::kable()

# Variables:
# Bacteria = Name of Bacteria type being expose to antibiotic
# Penicillin = antibiotic type
# Streptomycin = antibiotic type
# neomycin = antibiotic type
# gram = + treat with penicillin & neomycin
#        - neomycin
```

# Visualization

<!-- -------------------------------------------------- -->

### **q1** Prototype 5 visuals

To start, construct **5 qualitatively different visualizations of the
data** `df_antibiotics`. These **cannot** be simple variations on the
same graph; for instance, if two of your visuals could be made identical
by calling `coord_flip()`, then these are *not* qualitatively different.

For all five of the visuals, you must show information on *all 16
bacteria*. For the first two visuals, you must *show all variables*.

*Hint 1*: Try working quickly on this part; come up with a bunch of
ideas, and don't fixate on any one idea for too long. You will have a
chance to refine later in this challenge.

*Hint 2*: The data `df_antibiotics` are in a *wide* format; it may be
helpful to `pivot_longer()` the data to make certain visuals easier to
construct.

#### Visual 1 (All variables)

In this visual you must show *all three* effectiveness values for *all
16 bacteria*. This means **it must be possible to identify each of the
16 bacteria by name.** You must also show whether or not each bacterium
is Gram positive or negative.

```{r q1.1}
# Reshape the data into long format
data_long <- df_antibiotics %>%
  pivot_longer(cols = c(penicillin, streptomycin, neomycin), 
               names_to = "antibiotic", 
               values_to = "resistance")

# Reorder antibiotics to the desired order
data_long$antibiotic <- factor(data_long$antibiotic, levels = c("neomycin", "penicillin", "streptomycin"))

# Create the bar plot with facets for Gram status
ggplot(data_long, aes(x = bacteria, y = resistance, fill = antibiotic)) +
  geom_bar(stat = "identity", position = "dodge") +
  theme_minimal() +
  labs(title = "Antibiotic Resistance of Different Bacteria",
       x = "Bacteria",
       y = "Resistance Level",
       fill = "Antibiotic") +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),
        strip.text = element_text(size = 8)) +  # Rotate x-axis labels
  facet_wrap(~ gram) +  # Facet by Gram status (positive/negative)
  scale_fill_manual(values = c("neomycin" = "green", "penicillin" = "blue", "streptomycin" = "red"))  # Optional custom colors for antibiotics
```

#### Visual 2 (All variables)

In this visual you must show *all three* effectiveness values for *all
16 bacteria*. This means **it must be possible to identify each of the
16 bacteria by name.** You must also show whether or not each bacterium
is Gram positive or negative.

Note that your visual must be *qualitatively different* from *all* of
your other visuals.

```{r q1.2}
# Step 1: Pivot the data to long format
data_long <- df_antibiotics %>%
  pivot_longer(cols = c(penicillin, streptomycin, neomycin), names_to = "antibiotic", values_to = "resistance") %>%
  mutate(gram_status = ifelse(gram == "negative", "negative", "positive"))

# Step 2: Create a new column 'category' to define whether we are plotting Penicillin, Streptomycin, or Neomycin
data_long <- data_long %>%
  mutate(category = case_when(
    antibiotic == "penicillin" ~ "penicillin",
    antibiotic == "streptomycin" & gram_status == "positive" ~ "streptomycin_positive",
    antibiotic == "neomycin" & gram_status == "positive" ~ "neomycin_positive",
    antibiotic == "streptomycin" & gram_status == "negative" ~ "streptomycin_negative",
    antibiotic == "neomycin" & gram_status == "negative" ~ "neomycin_negative"
  ))

# Step 3: Plot the data
ggplot(data_long, aes(x = bacteria, y = resistance, fill = antibiotic)) +
  geom_bar(stat = "identity", position = "dodge") +
  scale_fill_manual(values = c("penicillin" = "red", "streptomycin" = "green", "neomycin" = "blue")) +  # Custom colors for Penicillin, Streptomycin, Neomycin
  labs(title = "Antibiotic Resistance by Bacteria",
       x = "Bacteria", 
       y = "Resistance Value") +
  facet_wrap(~ category, scales = "free_y", ncol = 3) +  # Separate facets for each category (penicillin, positive/negative streptomycin, neomycin)
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1),  # Rotate x-axis labels for readability
        strip.text = element_text(size = 12))  # Adjust the facet label text size
```

#### vVisual 3 (Some variables)

In this visual you may show a *subset* of the variables (`penicillin`,
`streptomycin`, `neomycin`, `gram`), but you must still show *all 16
bacteria*.

Note that your visual must be *qualitatively different* from *all* of
your other visuals.

```{r q1.3}

# Reshape data for heatmap
melted_data <- df_antibiotics %>% 
  pivot_longer(cols = c(penicillin, streptomycin, neomycin), names_to = "Antibiotic", values_to = "Sensitivity")

# Heatmap plot
ggplot(melted_data, aes(x = Antibiotic, y = bacteria, fill = log10(Sensitivity))) +
  geom_tile() +
  scale_fill_gradient(low = "blue", high = "green", name = "Sensitivity Level") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 45, hjust = 1)) +
  labs(title = "Bacterial Sensitivity to Antibiotics", x = "Antibiotics", y = "Bacteria")

```

#### Visual 4 (Some variables)

In this visual you may show a *subset* of the variables (`penicillin`,
`streptomycin`, `neomycin`, `gram`), but you must still show *all 16
bacteria*.

Note that your visual must be *qualitatively different* from *all* of
your other visuals.

```{r q1.4}
# Calculate total concentration and the percentage of each antibiotic
df_percentage <- df_antibiotics %>%
  mutate(
    total_concentration = penicillin + streptomycin + neomycin,
    penicillin_pct = (penicillin / total_concentration) * 100,
    streptomycin_pct = (streptomycin / total_concentration) * 100,
    neomycin_pct = (neomycin / total_concentration) * 100
  )

# Select relevant columns to display
df_percentage <- df_percentage %>%
  select(bacteria, penicillin_pct, streptomycin_pct, neomycin_pct)

# Create a long format data for plotting
df_percentage_long <- df_percentage %>%
  pivot_longer(cols = c(penicillin_pct, streptomycin_pct, neomycin_pct),
               names_to = "antibiotic",
               values_to = "percentage")

# Plot the data
ggplot(df_percentage_long, aes(x = bacteria, y = percentage, fill = antibiotic)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(title = "Percentage of Antibiotic Concentration by Bacteria",
       x = "Bacteria",
       y = "Percentage (%)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +  # Rotate x-axis labels
  scale_fill_manual(values = c("penicillin_pct" = "#FF6666", 
                               "streptomycin_pct" = "#66CC66", 
                               "neomycin_pct" = "#66CCFF"))
```

#### Visual 5 (Some variables)

In this visual you may show a *subset* of the variables (`penicillin`,
`streptomycin`, `neomycin`, `gram`), but you must still show *all 16
bacteria*.

Note that your visual must be *qualitatively different* from *all* of
your other visuals.

```{r q1.5}
# Pivot the data to long format
df_long <- df_antibiotics %>%
  select(bacteria, penicillin, streptomycin, neomycin) %>%
  pivot_longer(cols = c(penicillin, streptomycin, neomycin), 
               names_to = "antibiotic", 
               values_to = "concentration")

# Plot a stacked bar chart
ggplot(df_long, aes(x = bacteria, y = concentration, fill = antibiotic)) +
  geom_bar(stat = "identity", position = "stack") +
  labs(title = "Antibiotic Concentration by Bacteria",
       x = "Bacteria",
       y = "Concentration (mg/mL)") +
  theme_minimal() +
  theme(axis.text.x = element_text(angle = 90, hjust = 1)) +

  scale_fill_manual(values = c("penicillin" = "#FF6666", 
                               "streptomycin" = "#66CC66", 
                               "neomycin" = "#66CCFF"))
```

### **q2** Assess your visuals

There are **two questions** below; use your five visuals to help answer
both Guiding Questions. Note that you must also identify which of your
five visuals were most helpful in answering the questions.

*Hint 1*: It's possible that *none* of your visuals is effective in
answering the questions below. You may need to revise one or more of
your visuals to answer the questions below!

*Hint 2*: It's **highly unlikely** that the same visual is the most
effective at helping answer both guiding questions. **Use this as an
opportunity to think about why this is.**

#### Guiding Question 1

> How do the three antibiotics vary in their effectiveness against
> bacteria of different genera and Gram stain?

*Observations* - What is your response to the question above? - (Write
your response here) - Which of your visuals above (1 through 5) is
**most effective** at helping to answer this question? - (Write your
response here) - Why? - (Write your response here)

graph one lays out all the bacterias genera and their concentrations to
the 3 types of antibiotics. Theyre all on the same scale to compare the
values of each bacteria to the effective antibiotic amount. The bars are
also seperate into a left and right positive and negative gram on the
same scale to compare the antibiotic effectiveness with positive and
negative.

#### Guiding Question 2

In 1974 *Diplococcus pneumoniae* was renamed *Streptococcus pneumoniae*,
and in 1984 *Streptococcus fecalis* was renamed *Enterococcus fecalis*
[2].

> Why was *Diplococcus pneumoniae* was renamed *Streptococcus
> pneumoniae*?

*Observations* - What is your response to the question above? - (Write
your response here) - Which of your visuals above (1 through 5) is
**most effective** at helping to answer this question? - (Write your
response here) - Why? - (Write your response here)

I think Graph 4 is the most helpful because it shows you how much in
proportions are effective for how the antibiotics affect each bacteria.
From this *Diplococcus pneumoniae from column 4 is nearly identical to
Streptococcus hemolyticus. Then the same can be said for graph 2 but it
is harder to tell as there is a lot more data to look at to compare the
2 bacterias.*

# References

<!-- -------------------------------------------------- -->

[1] Neomycin in skin infections: A new topical antibiotic with wide
antibacterial range and rarely sensitizing. Scope. 1951;3(5):4-7.

[2] Wainer and Lysen, "That's Funny..." *American Scientist* (2009)
[link](https://www.americanscientist.org/article/thats-funny)
